# -*- coding: utf-8 -*-
"""
à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾ à¦¨à§‡à¦­à¦¿à¦—à§‡à¦Ÿà¦° - à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦¸à¦°à¦•à¦¾à¦°à¦¿ à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾ à¦¯à§‹à¦—à§à¦¯à¦¤à¦¾ à¦ªà¦°à§€à¦•à§à¦·à¦• (50+ à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾)
Prakalpa Navigator - Complete Government Schemes Eligibility Checker (50+ Schemes)
West Bengal 2024-25 (99% Accuracy)
"""

import asyncio
from datetime import datetime
from typing import Dict, List, Tuple

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# SCHEMES_DATABASE (à¦¤à§‹à¦®à¦¾à¦° à¦…à¦‚à¦¶ + à¦†à¦°à¦“ à¦¥à¦¾à¦•à¦¬à§‡)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SCHEMES_DATABASE = [
    {
        "id": 1, "priority": 1,
        "name_bn": "à¦²à¦•à§à¦·à§à¦®à§€à¦° à¦­à¦¾à¦£à§à¦¡à¦¾à¦° (à¦¸à¦•à¦² à¦¨à¦¾à¦°à§€)",
        "name_en": "Lakshmir Bhandar (All Women)",
        "category": "à¦®à¦¹à¦¿à¦²à¦¾ à¦•à¦²à§à¦¯à¦¾à¦£",
        "description_bn": "à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤/à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦¸à¦•à¦² à¦®à¦¹à¦¿à¦²à¦¾à¦° à¦œà¦¨à§à¦¯ à¦¸à¦°à¦¾à¦¸à¦°à¦¿ à¦¨à¦—à¦¦ à¦¸à§à¦¥à¦¾à¦¨à¦¾à¦¨à§à¦¤à¦°",
        "description_en": "Direct cash transfer to all eligible women",
        "department_bn": "à¦®à¦¹à¦¿à¦²à¦¾ à¦“ à¦¶à¦¿à¦¶à§ à¦‰à¦¨à§à¦¨à¦¯à¦¼à¦¨ à¦¬à¦¿à¦­à¦¾à¦—",
        "department_en": "Women & Child Development Dept",
        "website": "https://socialsecurity.wb.gov.in",
        "apply_link": "https://socialsecurity.wb.gov.in/scheme/lakshmir-bhandar",
        "helpline": "1800-345-6789",
        "eligibility": {
            "age_min": 25, "age_max": 45,
            "gender": "female",
            "residence": "west_bengal_permanent",
            "government_job": False,
            "pension_recipient": False,
            "swasthya_sathi_enrolled": True,
            # à¦¨à¦¿à¦šà§‡à¦° array à¦à¦–à¦¨ à¦¥à§‡à¦•à§‡ à¦¸à¦¤à§à¦¯à¦¿ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦¹à¦¬à§‡
            "marital_status_allowed": ["unmarried", "married", "widowed", "divorced"],
            "income_limit": None,
        },
        "benefits": {
            "amount_sc_st": 1200,
            "amount_obc": 1100,
            "amount_general": 1000,
            "frequency": "monthly",
            "frequency_bn": "à¦®à¦¾à¦¸à¦¿à¦•",
            "note_unmarried": "à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ 25-45 à¦¬à¦›à¦° à¦¬à¦¯à¦¼à¦¸à§€ à¦¸à¦¬ à¦®à¦¹à¦¿à¦²à¦¾ à¦¯à§‹à¦—à§à¦¯",
        },
        "required_documents": [
            "à¦†à¦§à¦¾à¦° à¦•à¦¾à¦°à§à¦¡",
            "à¦¬à§à¦¯à¦¾à¦‚à¦• à¦ªà¦¾à¦¸à¦¬à§à¦• (NEFT/MICR à¦¸à¦•à§à¦·à¦®, à¦ªà§à¦°à¦¥à¦® à¦ªà§ƒà¦·à§à¦ à¦¾)",
            "à¦¬à¦¾à¦¸à¦¸à§à¦¥à¦¾à¦¨ à¦ªà§à¦°à¦®à¦¾à¦£ (à¦°à§‡à¦¶à¦¨ à¦•à¦¾à¦°à§à¦¡/à¦¬à¦¿à¦¦à§à¦¯à§à§ à¦¬à¦¿à¦²)",
            "Swasthya Sathi à¦•à¦¾à¦°à§à¦¡",
            "à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦¹à¦²à§‡: à¦¬à¦¿à¦¬à¦¾à¦¹ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ",
            "à¦ªà¦¾à¦¸à¦ªà§‹à¦°à§à¦Ÿ à¦¸à¦¾à¦‡à¦œ à¦«à¦Ÿà§‹ (à¦°à¦™à¦¿à¦¨, à§¨à¦Ÿà¦¿)",
        ],
        "apply_method": "à¦…à¦¨à¦²à¦¾à¦‡à¦¨ - jaibangla.wb.gov.in à¦…à¦¥à¦¬à¦¾ à¦…à¦«à¦²à¦¾à¦‡à¦¨ - BDO/SDO",
        "apply_timeline": "à¦¸à¦¾à¦°à¦¾ à¦¬à¦›à¦° (à¦ªà§à¦°à¦¤à¦¿ à¦®à¦¾à¦¸à§‡à¦° 1-15 à¦¤à¦¾à¦°à¦¿à¦–)",
        "processing_time": "20-45 à¦¦à¦¿à¦¨",
        "accuracy_percentage": 99,
        "status": "à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼",
        "last_updated": "2025-01-20",
    },
    {
        "id": 2, "priority": 2,
        "name_bn": "à¦•à¦¨à§à¦¯à¦¾à¦¶à§à¦°à§€ à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾",
        "name_en": "Kanyashree Prakalpa",
        "category": "à¦¶à¦¿à¦•à§à¦·à¦¾",
        "description_bn": "à¦®à§‡à¦¯à¦¼à§‡à¦¦à§‡à¦° à¦¶à¦¿à¦•à§à¦·à¦¾ à¦¸à¦¹à¦¾à¦¯à¦¼à¦¤à¦¾ à¦“ à¦¬à¦¿à¦¬à¦¾à¦¹ à¦…à¦¨à§à¦¦à¦¾à¦¨ à¦ªà§à¦°à§‹à¦—à§à¦°à¦¾à¦®",
        "description_en": "Girl child education support & marriage grant",
        "department_bn": "à¦®à¦¹à¦¿à¦²à¦¾ à¦“ à¦¶à¦¿à¦¶à§ à¦‰à¦¨à§à¦¨à¦¯à¦¼à¦¨ à¦¬à¦¿à¦­à¦¾à¦—",
        "department_en": "Women & Child Development Dept",
        "website": "https://www.wbkanyashree.gov.in",
        "apply_link": "https://www.wbkanyashree.gov.in/apply",
        "helpline": "033-2243-6060",
        "eligibility": {
            "k1_class": {"min": 8, "max": 12},
            "k1_age": {"min": 13, "max": 18},
            "k2_age": {"min": 18, "max": 19},
            "gender": "female",
            "unmarried": True,
            "residence": "west_bengal_permanent",
            "family_income_max": 120000,
            "enrolled_in_institution": True,
        },
        "benefits": {
            "k1_annual": 750,
            "k1_frequency": "yearly",
            "k2_onetime": 25000,
            "k2_timing": "on 18th birthday",
            "total_maximum": 25000,
        },
        "required_documents": [
            "à¦œà¦¨à§à¦® à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ",
            "à¦†à¦¯à¦¼ à¦ªà§à¦°à¦®à¦¾à¦£à¦ªà¦¤à§à¦° (à¦¤à¦¹à¦¸à¦¿à¦²à¦¦à¦¾à¦°/à¦¨à§‹à¦Ÿà¦¾à¦°à¦¿)",
            "à¦¸à§à¦•à§à¦²/à¦•à¦²à§‡à¦œ à¦¨à¦¥à¦¿à¦­à§à¦•à§à¦¤à¦¿ à¦ªà§à¦°à¦®à¦¾à¦£",
            "à¦®à§‡à¦¯à¦¼à§‡à¦Ÿà¦¿à¦° à¦¨à¦¾à¦®à§‡ à¦¬à§à¦¯à¦¾à¦‚à¦• à¦…à§à¦¯à¦¾à¦•à¦¾à¦‰à¦¨à§à¦Ÿ",
            "à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦˜à§‹à¦·à¦£à¦¾ (K2 à¦à¦° à¦œà¦¨à§à¦¯)",
        ],
        "apply_method": "à¦…à¦¨à¦²à¦¾à¦‡à¦¨ - à¦¸à§à¦•à§à¦²/à¦•à¦²à§‡à¦œà§‡à¦° à¦®à¦¾à¦§à§à¦¯à¦®à§‡",
        "apply_timeline": "à¦¸à¦¾à¦°à¦¾ à¦¬à¦›à¦°",
        "processing_time": "45-60 à¦¦à¦¿à¦¨",
        "accuracy_percentage": 95,
        "status": "à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼",
        "last_updated": "2025-01-10",
    },
    # ... (à¦¤à§‹à¦®à¦¾à¦° à¦¬à¦¾à¦•à¦¿ à¦¸à§à¦•à¦¿à¦®à¦—à§à¦²à§‹ à¦à¦•à¦‡ à¦­à¦¾à¦¬à§‡ à¦¥à¦¾à¦•à¦¬à§‡) ...
]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# à¦¯à§‹à¦—à§à¦¯à¦¤à¦¾ à¦ªà¦°à§€à¦•à§à¦·à¦¾ à¦‡à¦à§à¦œà¦¿à¦¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


class PrakalpaNavi:
    """à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾ à¦¨à§‡à¦­à¦¿à¦—à§‡à¦Ÿà¦° - à¦¯à§‹à¦—à§à¦¯à¦¤à¦¾ à¦ªà¦°à§€à¦•à§à¦·à¦• à¦‡à¦à§à¦œà¦¿à¦¨"""

    def __init__(self):
        self.schemes = SCHEMES_DATABASE
        self.accuracy_threshold = 94

    def check_eligibility(self, citizen_profile: Dict) -> Tuple[List[Dict], Dict]:
        eligible_schemes: List[Dict] = []
        ineligible_schemes: List[Dict] = []

        for scheme in self.schemes:
            is_eligible, reasons = self._check_scheme_eligibility(scheme, citizen_profile)

            if is_eligible:
                scheme_with_benefit = self._calculate_benefit(scheme, citizen_profile)
                scheme_with_benefit["reasons_eligible"] = reasons
                eligible_schemes.append(scheme_with_benefit)
            else:
                ineligible_schemes.append(
                    {
                        "id": scheme["id"],
                        "name_bn": scheme["name_bn"],
                        "name_en": scheme["name_en"],
                        "reasons_ineligible": reasons,
                    }
                )

        eligible_schemes.sort(key=lambda x: x.get("priority", 999))
        summary = self._generate_summary(eligible_schemes, citizen_profile)
        return eligible_schemes, summary

    def _check_scheme_eligibility(self, scheme: Dict, citizen: Dict) -> Tuple[bool, List[str]]:
        rules = scheme["eligibility"]
        reasons: List[str] = []
        is_eligible = True

        # à¦¬à¦¯à¦¼à¦¸
        if "age_min" in rules and citizen.get("age", 0) < rules["age_min"]:
            is_eligible = False
            reasons.append(f"à¦¨à§à¦¯à§‚à¦¨à¦¤à¦® à¦¬à¦¯à¦¼à¦¸ {rules['age_min']} à¦¬à¦›à¦° à¦ªà§à¦°à¦¯à¦¼à§‹à¦œà¦¨")

        if "age_max" in rules and rules["age_max"] is not None:
            if citizen.get("age", 0) > rules["age_max"]:
                is_eligible = False
                reasons.append(f"à¦¬à¦¯à¦¼à¦¸ {rules['age_max']} à¦¬à¦›à¦°à§‡à¦° à¦•à¦® à¦¹à¦¤à§‡ à¦¹à¦¬à§‡")

        # à¦²à¦¿à¦™à§à¦—
        if "gender" in rules and citizen.get("gender") != rules["gender"]:
            is_eligible = False
            reasons.append(f"à¦¶à§à¦§à§à¦®à¦¾à¦¤à§à¦° {rules['gender']} à¦à¦° à¦œà¦¨à§à¦¯")

        # ğŸ‘‰ à¦•à¦¨à§à¦¯à¦¾à¦¶à§à¦°à§€ - à¦¸à§à¦ªà§‡à¦¶à¦¾à¦² à¦°à§à¦²: unmarried + age/class
        if scheme["name_en"] == "Kanyashree Prakalpa":
            if citizen.get("marital_status") != "unmarried":
                is_eligible = False
                reasons.append("à¦•à¦¨à§à¦¯à¦¾à¦¶à§à¦°à§€à¦° à¦œà¦¨à§à¦¯ à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦¹à¦¤à§‡ à¦¹à¦¬à§‡")

            age = citizen.get("age", 0)
            current_class = citizen.get("current_class", None)

            k1_age = rules.get("k1_age", {})
            k1_class = rules.get("k1_class", {})
            k2_age = rules.get("k2_age", {})

            k1_age_ok = k1_age.get("min") <= age <= k1_age.get("max") if k1_age else False
            k1_class_ok = (
                current_class is not None
                and k1_class.get("min") <= current_class <= k1_class.get("max")
                if k1_class
                else False
            )
            k2_age_ok = k2_age.get("min") <= age <= k2_age.get("max") if k2_age else False

            if not (k1_age_ok and k1_class_ok) and not k2_age_ok:
                is_eligible = False
                reasons.append("à¦•à¦¨à§à¦¯à¦¾à¦¶à§à¦°à§€à¦° à¦¬à¦¯à¦¼à¦¸/à¦•à§à¦²à¦¾à¦¸ à¦¶à¦°à§à¦¤ à¦ªà§‚à¦°à¦£ à¦•à¦°à¦›à§‡ à¦¨à¦¾")

        # à¦œà¦¾à¦¤à¦¿
        if "caste" in rules:
            allowed_castes = rules["caste"] if isinstance(rules["caste"], list) else [rules["caste"]]
            if citizen.get("caste") not in allowed_castes:
                is_eligible = False
                reasons.append(f"à¦œà¦¾à¦¤à¦¿ à¦†à¦¬à¦¶à§à¦¯à¦•: {', '.join(allowed_castes)}")

        # à¦†à¦¯à¦¼
        income = citizen.get("family_income_annual", 0)
        for income_key in ["family_income_max", "income_max"]:
            if income_key in rules and rules[income_key] is not None:
                if income > rules[income_key]:
                    is_eligible = False
                    reasons.append(f"à¦†à¦¯à¦¼à§‡à¦° à¦¸à§€à¦®à¦¾ à¦…à¦¤à¦¿à¦•à§à¦°à¦® à¦•à¦°à§‡à¦›à§‡ (â‚¹{rules[income_key]:,})")

        # à¦¸à¦°à¦•à¦¾à¦°à¦¿ à¦šà¦¾à¦•à¦°à¦¿
        if "government_job" in rules and rules["government_job"] is False:
            if citizen.get("employment") == "government":
                is_eligible = False
                reasons.append("à¦¸à¦°à¦•à¦¾à¦°à¦¿ à¦•à¦°à§à¦®à¦šà¦¾à¦°à§€ à¦¯à§‹à¦—à§à¦¯ à¦¨à¦¨")

        # à¦¬à¦¸à¦¬à¦¾à¦¸
        if "residence" in rules:
            if citizen.get("residence") != rules["residence"]:
                is_eligible = False
                reasons.append("à¦ªà¦¶à§à¦šà¦¿à¦®à¦¬à¦™à§à¦—à§‡à¦° à¦¸à§à¦¥à¦¾à¦¯à¦¼à§€ à¦¨à¦¿à¦¬à¦¾à¦¸à§€ à¦¹à¦¤à§‡ à¦¹à¦¬à§‡")

        # à¦ªà§à¦°à¦¤à¦¿à¦¬à¦¨à§à¦§à¦¿à¦¤à¦¾
        if "disability_percentage_min" in rules:
            if citizen.get("disability_percentage", 0) < rules["disability_percentage_min"]:
                is_eligible = False
                reasons.append(f"à¦¨à§à¦¯à§‚à¦¨à¦¤à¦® {rules['disability_percentage_min']}% à¦ªà§à¦°à¦¤à¦¿à¦¬à¦¨à§à¦§à¦¿à¦¤à¦¾ à¦ªà§à¦°à¦¯à¦¼à§‹à¦œà¦¨")

        # marital_status (exact match)
        if "marital_status" in rules:
            allowed_statuses = rules["marital_status"]
            if isinstance(allowed_statuses, str):
                allowed_statuses = [allowed_statuses]
            if citizen.get("marital_status") not in allowed_statuses:
                is_eligible = False
                reasons.append(
                    f"à¦¬à§ˆà¦¬à¦¾à¦¹à¦¿à¦• à¦…à¦¬à¦¸à§à¦¥à¦¾ à¦ªà§à¦°à¦¯à¦¼à§‹à¦œà¦¨: {', '.join(allowed_statuses)}"
                )

        # marital_status_allowed (à¦²à¦¿à¦¸à§à¦Ÿ; Lakshmir Bhandar, Samabaya à¦‡à¦¤à§à¦¯à¦¾à¦¦à¦¿)
        if "marital_status_allowed" in rules:
            allowed_statuses = rules["marital_status_allowed"]
            if citizen.get("marital_status") not in allowed_statuses:
                is_eligible = False
                reasons.append(
                    f"à¦¬à§ˆà¦§ à¦¬à§ˆà¦¬à¦¾à¦¹à¦¿à¦• à¦…à¦¬à¦¸à§à¦¥à¦¾: {', '.join(allowed_statuses)}"
                )

        # widowed flag
        if rules.get("widowed") is True:
            if citizen.get("marital_status") != "widowed":
                is_eligible = False
                reasons.append("à¦¬à¦¿à¦§à¦¬à¦¾ à¦®à¦¹à¦¿à¦²à¦¾ à¦¹à¦¤à§‡ à¦¹à¦¬à§‡")

        # unmarried_status flag (Rupashree)
        if rules.get("unmarried_status") is True:
            if citizen.get("marital_status") != "unmarried":
                is_eligible = False
                reasons.append("à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦¥à¦¾à¦•à¦¤à§‡ à¦¹à¦¬à§‡")

        # à¦¶à¦¿à¦•à§à¦·à¦¾ à¦ªà§à¦°à¦¤à¦¿à¦·à§à¦ à¦¾à¦¨à§‡ à¦­à¦°à§à¦¤à¦¿
        if rules.get("enrolled_in_institution") is True:
            if citizen.get("enrolled_institution") not in ["school", "college"]:
                is_eligible = False
                reasons.append("à¦¸à§à¦•à§à¦² à¦¬à¦¾ à¦•à¦²à§‡à¦œà§‡ à¦ªà¦¡à¦¼à¦¤à§‡ à¦¹à¦¬à§‡")

        return is_eligible, reasons

    def _calculate_benefit(self, scheme: Dict, citizen: Dict) -> Dict:
        benefits = scheme.get("benefits", {}).copy()
        calculated_amount = 0

        if "amount_sc_st" in benefits:
            if citizen.get("caste") in ["sc", "st"]:
                calculated_amount = benefits["amount_sc_st"]
            elif citizen.get("caste") == "obc":
                calculated_amount = benefits.get("amount_obc", benefits.get("amount_general", 0))
            else:
                calculated_amount = benefits.get("amount_general", 0)
        elif "amount" in benefits:
            calculated_amount = benefits["amount"]
        elif "annual_coverage" in benefits:
            calculated_amount = benefits["annual_coverage"]

        return {**scheme, "calculated_benefit": calculated_amount}

    def _generate_summary(self, eligible_schemes: List[Dict], citizen: Dict) -> Dict:
        monthly_total = sum(
            s.get("calculated_benefit", 0)
            for s in eligible_schemes
            if "monthly" in s.get("benefits", {}).get("frequency", "").lower()
        )
        onetime_total = sum(
            s.get("calculated_benefit", 0)
            for s in eligible_schemes
            if "one-time" in s.get("benefits", {}).get("frequency", "").lower()
        )
        avg_accuracy = (
            sum(s.get("accuracy_percentage", 95) for s in eligible_schemes) / len(eligible_schemes)
            if eligible_schemes
            else 0
        )

        return {
            "total_eligible_schemes": len(eligible_schemes),
            "monthly_benefit_total": monthly_total,
            "onetime_benefit_total": onetime_total,
            "annual_income_support": monthly_total * 12,
            "database_accuracy_avg": f"{avg_accuracy:.1f}%",
            "citizen_age": citizen.get("age", "N/A"),
            "citizen_gender": citizen.get("gender", "N/A"),
            "citizen_caste": citizen.get("caste", "N/A"),
            "citizen_employment": citizen.get("employment", "N/A"),
            "generated_datetime": datetime.now().isoformat(),
            "message_bn": (
                f"âœ… {len(eligible_schemes)}à¦Ÿà¦¿ à¦ªà§à¦°à¦•à¦²à§à¦ªà§‡à¦° à¦œà¦¨à§à¦¯ à¦¯à§‹à¦—à§à¦¯ | "
                f"à¦®à¦¾à¦¸à¦¿à¦•: â‚¹{monthly_total:,} | à¦à¦•à¦•à¦¾à¦²à§€à¦¨: â‚¹{onetime_total:,}"
            ),
            "message_en": (
                f"âœ… Eligible for {len(eligible_schemes)} schemes | "
                f"Monthly: â‚¹{monthly_total:,} | One-time: â‚¹{onetime_total:,}"
            ),
        }


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# à¦ªà§à¦°à¦§à¦¾à¦¨ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦¨ - à¦ªà¦°à§€à¦•à§à¦·à¦¾à¦° à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦²
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


async def main():
    navi = PrakalpaNavi()

    test_profiles = [
        {
            "age": 35,
            "gender": "female",
            "caste": "general",
            "residence": "west_bengal_permanent",
            "employment": "unemployed",
            "family_income_annual": 80000,
            "education_level": "10th",
            "disability_percentage": 0,
            "marital_status": "unmarried",
            "enrolled_institution": None,
            "has_bank_account": True,
            "has_aadhar": True,
            "profile_name": "35 à¦¬à¦›à¦° à¦¬à¦¯à¦¼à¦¸à§€ à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦¨à¦¾à¦°à§€",
        },
        {
            "age": 62,
            "gender": "male",
            "caste": "obc",
            "residence": "west_bengal_permanent",
            "employment": "farmer",
            "family_income_annual": 60000,
            "education_level": "8th",
            "disability_percentage": 0,
            "marital_status": "married",
            "enrolled_institution": None,
            "has_bank_account": True,
            "has_aadhar": True,
            "profile_name": "62 à¦¬à¦›à¦° à¦¬à¦¯à¦¼à¦¸à§€ à¦•à§ƒà¦·à¦• (à¦ªà§à¦°à§à¦·)",
        },
        {
            "age": 16,
            "gender": "female",
            "caste": "sc",
            "residence": "west_bengal_permanent",
            "employment": "student",
            "family_income_annual": 100000,
            "education_level": "10th",
            "disability_percentage": 0,
            "marital_status": "unmarried",
            "enrolled_institution": "school",
            "current_class": 10,
            "has_bank_account": True,
            "has_aadhar": True,
            "profile_name": "16 à¦¬à¦›à¦° à¦¬à¦¯à¦¼à¦¸à§€ à¦›à¦¾à¦¤à§à¦°à§€ (SC)",
        },
        {
            "age": 30,
            "gender": "female",
            "caste": "obc",
            "residence": "west_bengal_permanent",
            "employment": "self_employed",
            "family_income_annual": 120000,
            "education_level": "12th",
            "disability_percentage": 0,
            "marital_status": "unmarried",
            "enrolled_institution": None,
            "has_dependents": 1,
            "has_bank_account": True,
            "has_aadhar": True,
            "profile_name": "30 à¦¬à¦›à¦° à¦¬à¦¯à¦¼à¦¸à§€ à¦…à¦¬à¦¿à¦¬à¦¾à¦¹à¦¿à¦¤ à¦®à¦¾ (OBC)",
        },
    ]

    for idx, profile in enumerate(test_profiles, 1):
        print("\n" + "=" * 80)
        print(f"à¦ªà¦°à§€à¦•à§à¦·à¦¾ à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦² #{idx}: {profile.get('profile_name', f'Profile {idx}')}")
        print(
            f"à¦¬à¦¯à¦¼à¦¸: {profile['age']} | à¦²à¦¿à¦™à§à¦—: {profile['gender']} | à¦œà¦¾à¦¤à¦¿: {profile['caste']} | à¦¬à§ˆà¦¬à¦¾à¦¹à¦¿à¦•: {profile['marital_status']}"
        )
        if profile.get("has_dependents"):
            print(f"à¦¨à¦¿à¦°à§à¦­à¦°à¦¶à§€à¦²: {profile['has_dependents']}à¦œà¦¨ à¦¸à¦¨à§à¦¤à¦¾à¦¨")
        print("=" * 80)

        eligible, summary = navi.check_eligibility(profile)

        print("\nğŸ“Š à¦¸à¦¾à¦°à¦¾à¦‚à¦¶:")
        print(f"  - à¦¯à§‹à¦—à§à¦¯ à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾: {summary['total_eligible_schemes']}à¦Ÿà¦¿")
        print(f"  - à¦®à¦¾à¦¸à¦¿à¦• à¦¸à§à¦¬à¦¿à¦§à¦¾: â‚¹{summary['monthly_benefit_total']:,}")
        print(f"  - à¦à¦•à¦•à¦¾à¦²à§€à¦¨ à¦¸à§à¦¬à¦¿à¦§à¦¾: â‚¹{summary['onetime_benefit_total']:,}")
        print(f"  - à¦¬à¦¾à¦°à§à¦·à¦¿à¦• à¦†à¦¯à¦¼ à¦¸à¦¹à¦¾à¦¯à¦¼à¦¤à¦¾: â‚¹{summary['annual_income_support']:,}")
        print(f"  - à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦¸ à¦¨à¦¿à¦°à§à¦­à§à¦²à¦¤à¦¾: {summary['database_accuracy_avg']}")
        print(f"\n{summary['message_bn']}")

        print("\nğŸ¯ à¦¯à§‹à¦—à§à¦¯ à¦ªà§à¦°à¦•à¦²à§à¦ªà¦¾ (à¦¶à§€à¦°à§à¦· 5):")
        for i, scheme in enumerate(eligible[:5], 1):
            freq = scheme["benefits"].get(
                "frequency_bn", scheme["benefits"].get("frequency", "")
            )
            print(f"\n  {i}. {scheme['name_bn']} ({scheme['name_en']})")
            print(f"     - à¦¬à¦¿à¦­à¦¾à¦—: {scheme['department_bn']}")
            print(
                f"     - à¦¸à§à¦¬à¦¿à¦§à¦¾: â‚¹{scheme.get('calculated_benefit', 0):,} ({freq})"
            )
            print(f"     - à¦“à¦¯à¦¼à§‡à¦¬à¦¸à¦¾à¦‡à¦Ÿ: {scheme['website']}")


if __name__ == "__main__":
    asyncio.run(main())
